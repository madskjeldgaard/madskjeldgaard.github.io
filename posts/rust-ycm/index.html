<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>
        Setting up Vim and YouCompleteMe for Rust development ::
        Mads Kjeldgaard — Composer and developer
      </title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta
  name="description"
  content="These are notes for setting up YouCompleteMe - a program for autocompletion, code linting and debugging in the text editor Vim - for developing Rust programs. I find this program vital to my Rust workflow because it allows me to more easily explore code and correct mistakes before they reach the compiler. YouCompleteMe will tell you if there are syntactic mistakes in your code, it will tell you about unused variables and code and it will often suggest changes to problematic code."
/>
<meta
  name="keywords"
  content="computer music, supercollider, rust, vim, linux"
/>
<meta name="robots" content="noodp" />
<link rel="canonical" href="http://madskjeldgaard.dk/posts/rust-ycm/" />





<link rel="stylesheet" href="http://madskjeldgaard.dk/assets/style.css" />

<link rel="stylesheet" href="http://madskjeldgaard.dk/style.css" />


<link
  rel="apple-touch-icon-precomposed"
  sizes="144x144"
  href="http://madskjeldgaard.dk/img/apple-touch-icon-144-precomposed.png"
/>
<link rel="shortcut icon" href="http://madskjeldgaard.dk/img/favicon.png" />


<link href="http://madskjeldgaard.dk/assets/fonts/Inter-Italic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="http://madskjeldgaard.dk/assets/fonts/Inter-Regular.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="http://madskjeldgaard.dk/assets/fonts/Inter-Medium.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="http://madskjeldgaard.dk/assets/fonts/Inter-MediumItalic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="http://madskjeldgaard.dk/assets/fonts/Inter-Bold.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="http://madskjeldgaard.dk/assets/fonts/Inter-BoldItalic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">


<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="http://madskjeldgaard.dk/img/small/states-of-emergency.jpg"/>

<meta name="twitter:title" content="Setting up Vim and YouCompleteMe for Rust development"/>
<meta name="twitter:description" content="These are notes for setting up YouCompleteMe - a program for autocompletion, code linting and debugging in the text editor Vim - for developing Rust programs. I find this program vital to my Rust workflow because it allows me to more easily explore code and correct mistakes before they reach the compiler. YouCompleteMe will tell you if there are syntactic mistakes in your code, it will tell you about unused variables and code and it will often suggest changes to problematic code."/>



<meta property="og:title" content="Setting up Vim and YouCompleteMe for Rust development" />
<meta property="og:description" content="These are notes for setting up YouCompleteMe - a program for autocompletion, code linting and debugging in the text editor Vim - for developing Rust programs. I find this program vital to my Rust workflow because it allows me to more easily explore code and correct mistakes before they reach the compiler. YouCompleteMe will tell you if there are syntactic mistakes in your code, it will tell you about unused variables and code and it will often suggest changes to problematic code." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://madskjeldgaard.dk/posts/rust-ycm/" /><meta property="og:image" content="http://madskjeldgaard.dk/img/small/states-of-emergency.jpg"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-06-11T11:07:41+02:00" />
<meta property="article:modified_time" content="2020-06-11T11:07:41+02:00" /><meta property="og:site_name" content="Mads Kjeldgaard" />







  </head>
  <body class="dark-theme">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a
  href="/"
  class="logo"
  style="text-decoration: none;"
>
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367" />
</svg>
</span>
    <span class="logo__text"
      >madskjeldgaard</span
    >
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/pages/about">about</a></li>
        
      
        
          <li><a href="/pages/contact">contact</a></li>
        
      
        
          <li><a href="/posts">posts</a></li>
        
      
        
          <li><a href="/pages/software">software</a></li>
        
      
        
          <li><a href="/pages/work">sound</a></li>
        
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/pages/about">about</a></li>
      
    
      
        <li><a href="/pages/contact">contact</a></li>
      
    
      
        <li><a href="/posts">posts</a></li>
      
    
      
        <li><a href="/pages/software">software</a></li>
      
    
      
        <li><a href="/pages/work">sound</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none" />
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z" />
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg
  class="theme-toggler"
  width="24"
  height="24"
  viewBox="0 0 48 48"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"
  />
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  
  

  <div class="post">
    <h1 class="post-title">Setting up Vim and YouCompleteMe for Rust development</h1>
    <div class="post-meta">
      
        <span class="post-date">
          2020-06-11
        </span>

        
          
        
      

      


      
    </div>

    
      <span class="post-tags">
        
          <a href="http://madskjeldgaard.dk/tags/vim/">#vim</a>&nbsp;
        
          <a href="http://madskjeldgaard.dk/tags/nvim/">#nvim</a>&nbsp;
        
          <a href="http://madskjeldgaard.dk/tags/rust/">#rust</a>&nbsp;
        
      </span>
    

    

    <div class="post-content">
      
        
        <h2>Table of Contents</h2>
        <aside class="table-of-contents"><nav id="TableOfContents">
  <ul>
    <li><a href="#install-the-plugin">Install the plugin</a></li>
    <li><a href="#install-completion">Install completion</a></li>
    <li><a href="#extra-configuration">Extra configuration</a></li>
    <li><a href="#keybindings">Keybindings</a></li>
    <li><a href="#ultisnips">UltiSnips</a></li>
  </ul>
</nav></aside>
        
      
      <p>These are notes for setting up <a href="https://github.com/ycm-core/YouCompleteMe">YouCompleteMe</a> - a program for autocompletion, code linting and debugging in the text editor Vim - for developing Rust programs. I find this program vital to my Rust workflow because it allows me to more easily explore code and correct mistakes before they reach the compiler. YouCompleteMe will tell you if there are syntactic mistakes in your code, it will tell you about unused variables and code and it will often suggest changes to problematic code.</p>
<h2 id="install-the-plugin">
  Install the plugin
  <a href="#install-the-plugin" class="h-anchor" aria-hidden="true">#</a>
</h2>
<p>I am assuming here that you have both <code>git</code> and Vundle installed for NVim.</p>
<p>In Nvim, install YouCompleteMe by adding the plugin to your init.vim-file by executing <code>:e $MYVIMRC</code>.</p>
<p>Then, after <code>call plug#begin()</code> and before  <code>call plug#end()</code> add this line:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-vim" data-lang="vim"><span style="color:#a6e22e">Plug</span> <span style="color:#e6db74">&#39;ycm-core/YouCompleteMe&#39;</span><span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>Then re-source the init file by running the command <code>:source $MYVIMRC</code> and then install the plugin using <code>:PlugInstall</code>.</p>
<h2 id="install-completion">
  Install completion
  <a href="#install-completion" class="h-anchor" aria-hidden="true">#</a>
</h2>
<p>Next up we need to install the completion engines needed. You can cherry-pick the engines you need or do not need but I honestly just install it all.</p>
<p>This is done by going into the plugin folder of YouCompleteMe in a terminal, again assuming you are using Vundle for your plugins this will probably be:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">cd ~/.vim/plugged/YouCompleteMe/
./install.py --all
</code></pre></div><p>This will take a while to install.</p>
<p>Once that&rsquo;s done, there is a final step which is quite strange and hopefully it will change in the future. According to <a href="https://github.com/ycm-core/YouCompleteMe/wiki/Full-Installation-Guide">the full installation guide</a>, you need to install <a href="https://www.rustup.rs">rustup</a> if you haven&rsquo;t already.</p>
<p>Then we need to get toolchains and add them to YouCompleteMe.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell"><span style="color:#75715e"># Temporarily redirect rustup to be able to extract the source</span>
RUSTUP_HOME<span style="color:#f92672">=</span>~/rusttmp

<span style="color:#75715e"># Get the tools</span>
rustup toolchain install nightly
rustup default nightly
rustup component add rls rust-analysis rust-src
cd $RUSTUP_HOME/toolchains
</code></pre></div><p>Now you should be in the toolchains folder that you just downloaded. There should be a folder there named something depending on your system (on mine it&rsquo;s <code>nightly-x86_64-unknown-linux-gnu</code> because I&rsquo;m on linux). Move into it using <code>cd &lt;folder_name&gt;</code>.</p>
<p>Then, move the contents of the folder of your YouCompleteMe installation <code>~/.vim/plugged/YouCompleteMe/third_party/ycmd/third_party/rls</code>.</p>
<p>Check that you did it correctly by seeing the contents:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">ls ~/.vim/plugged/YouCompleteMe/third_party/ycmd/third_party/rls
</code></pre></div><p>This should return something like
<code>bin  etc  lib  share</code></p>
<h2 id="extra-configuration">
  Extra configuration
  <a href="#extra-configuration" class="h-anchor" aria-hidden="true">#</a>
</h2>
<p>I am actually not sure this is necessary anymore but I read somewhere that you need to enable Rust features in YouCompleteMe&rsquo;s extra configuration file.</p>
<p>Do this by adding this line to your <code>init.vim</code> file:</p>
<p><code>let g:ycm_global_ycm_extra_conf = '~/.config/nvim/global_extra_conf.py'</code></p>
<p>Then edit the config file in NVim by executing <code>:tabnew ~/.config/nvim/global_extra_conf.py</code>.</p>
<p>Here is what mine looks like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">Settings</span>(<span style="color:#f92672">**</span>kwargs):
    <span style="color:#66d9ef">if</span> kwargs[<span style="color:#e6db74">&#39;language&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;rust&#39;</span>:
        <span style="color:#66d9ef">return</span> {
            <span style="color:#e6db74">&#39;ls&#39;</span>: {
                <span style="color:#e6db74">&#39;rust&#39;</span>: {
                    <span style="color:#75715e"># &#39;features&#39;: [&#39;http2&#39;, &#39;spnego&#39;],</span>
                    <span style="color:#e6db74">&#39;all_features&#39;</span>: <span style="color:#66d9ef">True</span>,
                    <span style="color:#e6db74">&#39;racer_completion&#39;</span>: <span style="color:#66d9ef">True</span>,
                    <span style="color:#75715e"># &#39;all_targets&#39;: False,</span>
                    <span style="color:#75715e"># &#39;wait_to_build&#39;: 1500,</span>
                }
            }
        }
</code></pre></div><h2 id="keybindings">
  Keybindings
  <a href="#keybindings" class="h-anchor" aria-hidden="true">#</a>
</h2>
<p>Here are the keybindings I use for Rust/YouCompleteMe:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-vim" data-lang="vim"><span style="color:#75715e">&#34; YCM KEYBINDINGS</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">function</span>! <span style="color:#a6e22e">YcmStuff</span>() <span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#a6e22e">nnoremap</span> <span style="color:#a6e22e">si</span> :<span style="color:#a6e22e">YcmCompleter</span> <span style="color:#a6e22e">GoToDefinition</span>&lt;<span style="color:#a6e22e">cr</span>&gt;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#a6e22e">nnoremap</span> <span style="color:#a6e22e">sk</span> :<span style="color:#a6e22e">YcmRestartServer</span>&lt;<span style="color:#a6e22e">cr</span>&gt;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#a6e22e">nnoremap</span> &lt;<span style="color:#a6e22e">F1</span>&gt; :<span style="color:#a6e22e">YcmCompleter</span> <span style="color:#a6e22e">FixIt</span>&lt;<span style="color:#a6e22e">cr</span>&gt;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#a6e22e">nnoremap</span> <span style="color:#a6e22e">K</span> :<span style="color:#a6e22e">YcmCompleter</span> <span style="color:#a6e22e">GetDoc</span>&lt;<span style="color:#a6e22e">cr</span>&gt;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#a6e22e">nnoremap</span> ; :<span style="color:#a6e22e">YcmCompleter</span> <span style="color:#a6e22e">GetType</span>&lt;<span style="color:#a6e22e">cr</span>&gt;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">endfunction</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">function</span>! <span style="color:#a6e22e">Rusty</span>()<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#a6e22e">nnoremap</span> &lt;<span style="color:#a6e22e">C</span>-<span style="color:#a6e22e">e</span>&gt; :<span style="color:#a6e22e">terminal</span> <span style="color:#a6e22e">cargo</span> <span style="color:#a6e22e">run</span>&lt;<span style="color:#a6e22e">cr</span>&gt;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#a6e22e">inoremap</span> &lt;<span style="color:#a6e22e">C</span>-<span style="color:#a6e22e">e</span>&gt; &lt;<span style="color:#a6e22e">esc</span>&gt;:<span style="color:#a6e22e">terminal</span> <span style="color:#a6e22e">cargo</span> <span style="color:#a6e22e">run</span>&lt;<span style="color:#a6e22e">cr</span>&gt;<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">endfunction</span> <span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#a6e22e">augroup</span> <span style="color:#a6e22e">rust</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#a6e22e">autocmd</span>!<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    <span style="color:#a6e22e">autocmd</span> <span style="color:#a6e22e">FileType</span> <span style="color:#a6e22e">rust</span> <span style="color:#a6e22e">call</span> <span style="color:#a6e22e">Rusty</span>()<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>	<span style="color:#a6e22e">autocmd</span> <span style="color:#a6e22e">FileType</span> <span style="color:#a6e22e">rust</span> <span style="color:#a6e22e">call</span> <span style="color:#a6e22e">YcmStuff</span>()<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#a6e22e">augroup</span> <span style="color:#a6e22e">end</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><h2 id="ultisnips">
  UltiSnips
  <a href="#ultisnips" class="h-anchor" aria-hidden="true">#</a>
</h2>
<p>I use these configuration lines to make UltiSnips work with YouCompleteMe to be able to use snippets as well as autocompletion.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-vim" data-lang="vim"><span style="color:#75715e">&#34; YouCompleteMe and UltiSnips compatibility.</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">g</span>:<span style="color:#a6e22e">ycm_use_ultisnips_completer</span> = <span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">g</span>:<span style="color:#a6e22e">ycm_key_list_select_completion</span>=[]<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">g</span>:<span style="color:#a6e22e">ycm_key_list_previous_completion</span>=[]<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#75715e">
</span><span style="color:#75715e">&#34; Expand snippets from UltiSnips with tab</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">g</span>:<span style="color:#a6e22e">UltiSnipsExpandTrigger</span>=<span style="color:#e6db74">&#34;&lt;Tab&gt;&#34;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">g</span>:<span style="color:#a6e22e">UltiSnipsJumpForwardTrigger</span>=<span style="color:#e6db74">&#34;&lt;Tab&gt;&#34;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">g</span>:<span style="color:#a6e22e">UltiSnipsJumpBackwardTrigger</span>=<span style="color:#e6db74">&#34;&lt;c-tab&gt;&#34;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">g</span>:<span style="color:#a6e22e">UltiSnipsSnippetDirectories</span> = [<span style="color:#e6db74">&#39;UltiSnips&#39;</span>]<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div>
    </div>
    
      
        <div class="pagination">
          <div class="pagination__title">
            <span class="pagination__title-h"
              >Read other posts</span
            >
            <hr />
          </div>
          <div class="pagination__buttons">
            
              <span class="button previous">
                <a href="http://madskjeldgaard.dk/posts/raspi-4-gpio-button-rust/">
                  <span class="button__icon">←</span>
                  <span class="button__text">Raspberry Pi 4: Simple Button to OSC example in Rust</span>
                </a>
              </span>
            
            
              <span class="button next">
                <a href="http://madskjeldgaard.dk/posts/interview-pa-2020/">
                  <span class="button__text">Interview with Passive/Aggressive</span>
                  <span class="button__icon">→</span>
                </a>
              </span>
            
          </div>
        </div>
      
    

    
      
        

      
    
  </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <a
  href="/"
  class="logo"
  style="text-decoration: none;"
>
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367" />
</svg>
</span>
    <span class="logo__text"
      >madskjeldgaard</span
    >
    <span class="logo__cursor"></span>
  
</a>

      <div class="copyright">
        <span
          >© 2022 Powered by
          <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a></span
        >
        <span
          >Theme created by
          <a href="https://twitter.com/panr" target="_blank" rel="noopener">panr</a></span
        >
      </div>
    
  </div>
</footer>

<script src="http://madskjeldgaard.dk/assets/main.js"></script>
<script src="http://madskjeldgaard.dk/assets/prism.js"></script>


      
    </div>

    
  </body>
</html>
